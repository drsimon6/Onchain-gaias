SELECT
  DATE_TRUNC('{{Time_frame}}', HOUR) AS date,
  SYMBOL,
  MIN(PRICE) AS min_price,
  AVG(PRICE) AS avg_price,
  MAX(PRICE) AS max_price,
  AVG(AVG(PRICE)) OVER (
    ORDER BY
      DATE ROWS BETWEEN 7 PRECEDING
      AND CURRENT ROW
  ) AS MA7,
  AVG(AVG(PRICE)) OVER (
    ORDER BY
      DATE ROWS BETWEEN 52 PRECEDING
      AND CURRENT ROW
  ) AS MA52,
  AVG(AVG(PRICE)) OVER (
    ORDER BY
      DATE ROWS BETWEEN 100 PRECEDING
      AND CURRENT ROW
  ) AS MA100,
  AVG(AVG(PRICE)) OVER (
    ORDER BY
      DATE ROWS BETWEEN 200 PRECEDING
      AND CURRENT ROW
  ) AS MA200
FROM
  base.price.ez_hourly_token_prices
WHERE
  SYMBOL IN ('DEGEN')
GROUP BY
  1,
  2
